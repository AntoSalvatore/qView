steps:
- script: |
    git clone https://github.com/Skycoder42/QtApng
    git checkout $(git tag | tail -1)
    cd QtApng
    qmake "CONFIG += libpng_static"
    make
    sudo make install
  displayName: Build APNG plugin

- script: |
    git clone https://github.com/novomesk/qt-avif-image-plugin
    git checkout $(git tag | tail -1)
    cd qt-avif-image-plugin
    ./build_libqavif_static.sh
    make
    sudo make install
  displayName: Build AVIF plugin

  # Skip HEIF on mac because Qt supports HEIF on mac for some reason
- script: |
    git clone https://github.com/strukturag/libde265
    git checkout $(git tag | tail -1)
    cd libde265
    ./autogen.sh
    ./configure --disable-sherlock265
    make
    sudo make install

    git clone https://github.com/strukturag/libheif
    git checkout $(git tag | tail -1)
    cd libheif
    ./autogen.sh
    ./configure
    make
    sudo make install
    
    git clone https://github.com/jakar/qt-heif-image-plugin
    git checkout $(git tag | tail -1)
    cd qt-heif-image-plugin
    cmake .
    make
    sudo make install
  condition: ne( variables['Agent.OS'], 'Darwin' )
  displayName: Build HEIF plugin

  # gtk2 and qt5ct style plugins for linux appimages
- script: |
    git clone https://code.qt.io/qt/qtstyleplugins.git
    cd qtstyleplugins
    qmake
    sudo make install

    wget 'https://sourceforge.net/projects/qt5ct/files/latest/download'
    tar xf download
    cd qt5ct*
    qmake
    sudo make install
  condition: eq( variables['Agent.OS'], 'Linux' )
  displayName: Get GTK+2 and qt5ct styles